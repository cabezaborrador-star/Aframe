<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
</head>

<body style="margin:0; overflow:hidden;">

<button id="moveBtn"
style="
position:fixed;
bottom:20px;
left:50%;
transform:translateX(-50%);
padding:15px 30px;
font-size:18px;
background:#228B22;
color:white;
border:none;
border-radius:10px;
z-index:999;">
CAMINAR
</button>

<a-scene>

  <!-- CIELO -->
  <a-sky color="#87CEEB"></a-sky>

  <!-- CÃ¡mara -->
  <a-entity id="rig" position="0 1.6 0">
    <a-camera look-controls="touchEnabled: true"></a-camera>
  </a-entity>

  <!-- Luces -->
  <a-light type="ambient" intensity="0.8"></a-light>
  <a-light type="directional" position="5 10 5"></a-light>

  <!-- Piso -->
  <a-plane rotation="-90 0 0"
           width="200"
           height="200"
           color="#2E8B57">
  </a-plane>

  <!-- Bosque -->
  <a-entity id="forest"></a-entity>

</a-scene>

<script>

let forest = document.querySelector("#forest");

for (let i = 0; i < 80; i++) {

  let x = (Math.random() - 0.5) * 100;
  let z = (Math.random() - 0.5) * 100;

  let tree = document.createElement("a-entity");

  tree.innerHTML = `
    <a-cylinder position="${x} 1 ${z}"
                radius="0.2"
                height="2"
                color="#8B4513">
    </a-cylinder>

    <a-cone position="${x} 2.5 ${z}"
            radius-bottom="1"
            height="2"
            color="#228B22">
    </a-cone>
  `;

  forest.appendChild(tree);
}

let moving = false;
let rig = document.querySelector("#rig");

document.getElementById("moveBtn").addEventListener("touchstart", () => {
  moving = true;
});

document.getElementById("moveBtn").addEventListener("touchend", () => {
  moving = false;
});

function moveForward() {
  if (moving) {
    let pos = rig.getAttribute("position");
    let rotation = rig.object3D.rotation.y;

    pos.x -= Math.sin(rotation) * 0.1;
    pos.z -= Math.cos(rotation) * 0.1;

    rig.setAttribute("position", pos);
  }

  requestAnimationFrame(moveForward);
}

moveForward();

</script>

</body>
</html>
